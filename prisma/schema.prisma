generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model appointment {
  id                 String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  appointment_date   DateTime                @db.Timestamp(6)
  address_snapshot   String                  @db.VarChar(100)
  service_id         String                  @db.Uuid
  doctor_id          String                  @db.Uuid
  patient_id         String                  @db.Uuid
  appointment_status appointment_status_type @default(pending)
  created_at         DateTime                @default(now()) @db.Timestamp(6)
  updated_at         DateTime?               @db.Timestamp(6)
  doctor             doctor                  @relation(fields: [doctor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_appointment_doctor")
  patient            patient                 @relation(fields: [patient_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_appointment_patient")
  service            service                 @relation(fields: [service_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_appointment_service")
}

model doctor {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String            @db.VarChar(50)
  phone_number      String            @unique @db.VarChar(50)
  rut               String            @unique @db.VarChar(50)
  user_id           String            @unique @db.Uuid
  specialization_id String            @db.Uuid
  created_at        DateTime?         @default(now()) @db.Timestamp(6)
  updated_at        DateTime?         @db.Timestamp(6)
  appointment       appointment[]
  specialization    specialization    @relation(fields: [specialization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_doctor_specialization")
  user              user              @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_doctor_user")
  doctor_schedule   doctor_schedule[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model doctor_schedule {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  day_of_week Int
  start_time  DateTime  @db.Time(6)
  end_time    DateTime  @db.Time(6)
  doctor_id   String    @db.Uuid
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @db.Timestamp(6)
  doctor      doctor    @relation(fields: [doctor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_doctor_schedule_doctor")

  @@unique([doctor_id, day_of_week, start_time])
}

model patient {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String        @db.VarChar(50)
  phone_number    String        @unique @db.VarChar(50)
  rut             String        @unique @db.VarChar(50)
  default_address String?       @db.VarChar(50)
  user_id         String?       @unique @db.Uuid
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  updated_at      DateTime?     @db.Timestamp(6)
  appointment     appointment[]
  user            user?         @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_patient_user")
}

model service {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String         @unique @db.VarChar(50)
  description       String         @db.VarChar(50)
  price             Int
  created_at        DateTime       @default(now()) @db.Timestamp(6)
  updated_at        DateTime?      @db.Timestamp(6)
  specialization_id String         @db.Uuid
  appointment       appointment[]
  specialization    specialization @relation(fields: [specialization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_service_specialization")
}

model specialization {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String    @unique @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @db.Timestamp(6)
  doctor     doctor[]
  service    service[]
}

model user {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email       String      @unique @db.VarChar(100)
  password    String      @db.VarChar(100)
  user_role   roles_type  @default(patient)
  user_status status_type @default(active)
  created_at  DateTime?   @default(now()) @db.Timestamp(6)
  deleted_at  DateTime?   @db.Timestamp(6)
  updated_at  DateTime?   @db.Timestamp(6)
  doctor      doctor?
  patient     patient?
}

enum appointment_status_type {
  pending
  confirmed
  cancelled
}

enum roles_type {
  admin
  patient
  doctor
}

enum status_type {
  active
  inactive
  suspended
  deleted
}
