generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model address {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  street      String        @db.VarChar(200)
  number      String        @db.VarChar(50)
  commune     String        @db.VarChar(100)
  reference   String?       @db.VarChar(200)
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  appointment appointment[]

  @@unique([street, number])
}

model appointment {
  id                    String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  date                  DateTime           @db.Timestamp(6)
  comment               String?            @db.VarChar(200)
  created_at            DateTime?          @default(now()) @db.Timestamp(6)
  service_id            String             @db.Uuid
  doctor_id             String             @db.Uuid
  patient_id            String             @db.Uuid
  address_id            String             @db.Uuid
  appointment_status_id String             @db.Uuid
  address               address            @relation(fields: [address_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_appointment_address")
  doctor                doctor             @relation(fields: [doctor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_appointment_doctor")
  patient               patient            @relation(fields: [patient_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_appointment_patient")
  service               service            @relation(fields: [service_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_appointment_service")
  appointment_status    appointment_status @relation(fields: [appointment_status_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_appointment_status")

  @@unique([date, doctor_id])
}

model appointment_status {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        status        @unique
  appointment appointment[]
}

model doctor {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String            @db.VarChar(200)
  phonenumber       String            @unique @db.VarChar(20)
  rut               String            @unique @db.VarChar(20)
  created_at        DateTime?         @default(now()) @db.Timestamp(6)
  specialization_id String            @db.Uuid
  user_id           String            @db.Uuid
  appointment       appointment[]
  doctor_schedule   doctor_schedule[]
}

model doctor_schedule {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  day_of_week Int
  start_time  DateTime @db.Time(6)
  end_time    DateTime @db.Time(6)
  doctor_id   String   @db.Uuid
  doctor      doctor   @relation(fields: [doctor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_doctor_schedule_doctor")
}

model patient {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String        @db.VarChar(200)
  phonenumber String        @unique @db.VarChar(20)
  rut         String        @unique @db.VarChar(20)
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  user_id     String?       @db.Uuid
  appointment appointment[]
}

model service {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String         @unique @db.VarChar(100)
  description       String         @db.VarChar(250)
  price             Int
  created_at        DateTime?      @default(now()) @db.Timestamp(6)
  specialization_id String         @db.Uuid
  appointment       appointment[]
  specialization    specialization @relation(fields: [specialization_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_service_specialization")
}

model specialization {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String    @unique @db.VarChar(100)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  service    service[]
}

model user {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email      String    @unique @db.VarChar(200)
  password   String    @db.VarChar(200)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  role       roles     @default(patient)
  is_active  Boolean?  @default(false)
  deleted_at DateTime? @db.Timestamp(6)
}

enum roles {
  admin
  doctor
  patient
}

enum status {
  pending
  accept
  reject
  completed
}
