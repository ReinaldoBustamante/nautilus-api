generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model appointment {
  id                    String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  appointment_date      DateTime                @db.Timestamp(6)
  appointment_status    appointment_status_type @default(pending)
  address_snapshot      String                  @db.VarChar(100)
  email_snapshot        String                  @db.VarChar(100)
  phone_number_snapshot String                  @db.VarChar(100)
  comment               String?
  doctor_id             String                  @db.Uuid
  patient_id            String                  @db.Uuid
  created_at            DateTime                @default(now()) @db.Timestamp(6)
  updated_at            DateTime?               @db.Timestamp(6)
  deleted_at            DateTime?               @db.Timestamp(6)
  doctor                doctor                  @relation(fields: [doctor_id], references: [id], onUpdate: NoAction, map: "fk_appointment_doctor")
  patient               patient                 @relation(fields: [patient_id], references: [id], onUpdate: NoAction, map: "fk_appointment_patient")
}

model doctor {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String            @db.VarChar(50)
  phone_number      String            @db.VarChar(50)
  rut               String            @db.VarChar(20)
  specialization_id String            @db.Uuid
  user_id           String            @db.Uuid
  created_at        DateTime          @default(now()) @db.Timestamp(6)
  updated_at        DateTime?         @db.Timestamp(6)
  deleted_at        DateTime?         @db.Timestamp(6)
  appointment       appointment[]
  specialization    specialization    @relation(fields: [specialization_id], references: [id], onUpdate: NoAction, map: "fk_doctor_specialization")
  user              user              @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "fk_doctor_user")
  doctor_schedule   doctor_schedule[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model doctor_schedule {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  day_of_week  Int
  start_time   String    @db.VarChar(50)
  end_time     String    @db.VarChar(50)
  doctor_id    String    @db.Uuid
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @db.Timestamp(6)
  is_activated Boolean?  @default(true)
  doctor       doctor    @relation(fields: [doctor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_doctor_schedule_doctor")

  @@unique([day_of_week, doctor_id, start_time])
}

model patient {
  id                   String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String        @db.VarChar(100)
  rut                  String        @db.VarChar(20)
  default_phone_number String        @db.VarChar(30)
  default_address      String        @db.VarChar(100)
  user_id              String?       @db.Uuid
  created_at           DateTime      @default(now()) @db.Timestamp(6)
  updated_at           DateTime?     @db.Timestamp(6)
  deleted_at           DateTime?     @db.Timestamp(6)
  appointment          appointment[]
  user                 user?         @relation(fields: [user_id], references: [id], onDelete: Restrict, onUpdate: NoAction, map: "fk_patient_user")
}

model specialization {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String    @db.VarChar(50)
  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime? @db.Timestamp(6)
  deleted_at DateTime? @db.Timestamp(6)
  doctor     doctor[]
}

model user {
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email       String           @db.VarChar(100)
  password    String           @db.VarChar(200)
  user_role   user_role_type   @default(patient)
  user_status user_status_type @default(inactive)
  created_at  DateTime         @default(now()) @db.Timestamp(6)
  updated_at  DateTime?        @db.Timestamp(6)
  deleted_at  DateTime?        @db.Timestamp(6)
  doctor      doctor[]
  patient     patient[]

  @@index([email, deleted_at])
}

enum appointment_status_type {
  pending
  confirmed
  cancelled
  completed
}

enum user_role_type {
  admin
  patient
  doctor
}

enum user_status_type {
  active
  inactive
  suspended
  deleted
}
